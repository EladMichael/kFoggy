\documentclass[12pt,reqno]{article}

\usepackage[usenames]{color}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amscd}
\usepackage{graphicx}

\usepackage[colorlinks=true,
linkcolor=webgreen,
filecolor=webbrown,
citecolor=webgreen]{hyperref}

\definecolor{webgreen}{rgb}{0,.5,0}
\definecolor{webbrown}{rgb}{.6,0,0}

\usepackage{color}
\usepackage{fullpage}
\usepackage{float}

\usepackage{graphics}
\usepackage{latexsym}
\usepackage{epsf}

\setlength{\textwidth}{6.5in}
\setlength{\oddsidemargin}{.1in}
\setlength{\evensidemargin}{.1in}
\setlength{\topmargin}{-.1in}
\setlength{\textheight}{8.4in}

\newcommand{\seqnum}[1]{\href{https://oeis.org/#1}{\rm \underline{#1}}}
\usepackage{mathtools}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}


\begin{document}

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{conjecture}[theorem]{Conjecture}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

\begin{center}
\vskip 1cm{\Large\bf 
On the Properties of\\
\vskip .1in
A Self Counting Sequence
}
\vskip 1cm
Elad Michael\\
\href{mailto:elad.michael@gmail.com}{\tt elad.michael@gmail.com}\\
\ \\
\end{center}

\vskip .2 in

\begin{abstract}
We present a self referential rule for sequence generation, parametrized by a postive integer $k$, originally proposed in a \href{https://www.reddit.com/r/math/comments/gdsjth/foggy_sequences/}{Reddit post}. We prove that for each $k$ the sequence is eventually periodic, and the period must be greater than or equal to $k+1$. We further conjecture that a repeating cycle of length $k+1$ exists for all $k$-sequences, and include constructions for several infinite families of integers. 
\end{abstract}

\section{Self Counting Sequence}

Throughout the paper, let $k\in\mathbb{Z}^{+}$ be the paramatrizing integer chosen to generate the sequence. As \href{https://www.reddit.com/r/math/comments/gdsjth/foggy_sequences/}{originally posed}, the sequence can be generated by the following rules:
\begin{enumerate}
  \item $\mathcal{S}_k(0) = 1$,
  \item $\mathcal{S}_k(n) := \sum\limits_{i=n-k}^{n-1} [ \mathcal{S}_k(i) = \mathcal{S}_k(n-1) ]$ where we use the Iverson bracket notation, i.e. $[P]$ returns $1$ if $P$ is true and $0$ if $P$ is false.
\end{enumerate}
To describe the sequence in words, we begin with a $1$, and each subsequent term is the number of occurences of the last term in the last $k$ terms. In~\eqref{eq:5seq} we show the first $30$ terms of the sequence for $k=5$.
\begin{equation}
  \mathcal{S}_5 : 1,1,2,1,3,1,3,2,1,2,2,3,1,2,3,2,2,3,2,3,2,3,3,3,4,1,1,2,1,3,\dots \label{eq:5seq}
\end{equation}
For the first $k$ terms of the sequence, we only count the occurence of a term from the beginning of the sequence. Equivalently, we may pad the beginning of the sequence with a set of $k-1$ zeros. Further, each term in the sequence is treated as a single digit, i.e. a term of $17$ does not count towards the counting of $1$s or $7$s. 

Throughout this work, unless otherwise noted, we have excluded the trivial possibility that  
\begin{align}
\mathcal{S}_k = ...,\overbrace{k,k,k,...,k,k}^{\textrm{k occurences}},...
\end{align}
It can be easily shown that the trivial sequence of repeating $k$ only occurs if the sequence began with repeating terms of $k$, i.e. it cannot arise from the sequence beginning with $1$. 

\begin{definition}\label{def:ultimatelyPeriodic}
A sequence $\mathcal{S}_k$ is ultimately periodic if there exist $t_0,T\in\mathcal{Z}^{+}$ such that $\mathcal{S}_k(t_0+n) = \mathcal{S}_k(t_0+T+n) \; \forall \; n \geq 0$. We call $T$ the period of the cycle.
\end{definition}
Note that for a periodic sequence there are infinitely many valid periods $T$ (all integer multiples), we will always refer to the \emph{least} value as the period. 

\begin{theorem}\label{thm:ultimatelyPeriodic}
For any $k$, the self counting sequence is ultimately periodic with period $T \leq k^k$. 
\end{theorem}

\begin{proof}
The $n$-th term of the sequence is a function of the $k$ previous terms, each of which are drawn from the set $\{1,2,3...,k\}$. Therefore, there are at most $k^k$ unique subsequences, and there exists a $t_0$ such that $S_k(t_0+n) = S_k(k^k+n) \; \forall n\in\{1,2,...,k\}$. Therefore, given the rules to generate the sequence only depend on the previous $k$ terms, we have $S_k(t_0+n) = S_k(k^k+n) \; \forall n \geq 0$ with period of $T \leq k^k$.
\end{proof}

Clearly $k^k$ is an extremely conservative bound, for example the $\mathcal{S}_5$ sequence~\eqref{eq:5seq} has period $T_5 = 25 << 5^5$. Our main results are concerned with the eventually periodic nature of these sequences, and are presented in Theorem \textbf{todo} and Conjecture \textbf{todo}. First we provide a few lemmas and a theorem bounding the value of the sequence terms.

\begin{lemma}\label{lem:longestRun}
A term $a\in\mathcal{S}_k$ cannot occur more than $a+1$ times consecutively within $\mathcal{S}_k$.  
\end{lemma}

\begin{proof}
For any element $a\in\mathcal{S}_k$, assume there exists an index $t>0$ such that $\mathcal{S}_k(t+i) = a$ for $0 \leq i \leq a+1$, i.e. $a$ has occured $a+1$ times consecutively. Clearly, as $a\in\mathcal{S}_k$, we have $a \leq k$, and therefore all $a+1$ terms are counted for the subsequent term, which must then be $a+1$.
\end{proof}

\begin{lemma}\label{lem:twiceInARow}
For a given $\mathcal{S}_k$, no term $a \geq \floor{\frac{k}{2}}+1$ occurs twice consecutively.
\end{lemma}

\begin{proof}
Assume there exists an index $t_0$ and elements $a,b\in\mathcal{S}_k$ such that 
\begin{align}
\mathcal{S}_k = \overbrace{...}^{t_0},b,a,a,...
\end{align}
with $a\geq \floor{\frac{k}{2}}+1$ and $b\neq a$. From indices $t_0 - k + 1$ to $t_0+1$, the element $b$ must occur $a$ times, and occur at least $a-1$ times between indices $t_0-k+2$ to $t_0+1$. Similarly, the element $a$ must occur $a$ times between indices $t_0 - k + 2$ to $t_0+2$. We thus have $a-1 + a$ occurences of elements $a$ and $b$ between indices $t_0 - k + 2$ to $t_0+2$



From the pigeonhole principle, if we have a sub-sequence $X^{\neq s},s,s$ where $s>\ceil{\frac{k}{2}}$, then the previous $k$ terms (before $X^{\neq s}$) must have contained $s$ occurences of $X^{\neq s}$. Therefore, including the first occurence of $s$, we have $s-1$ occurances of $X^{\neq s}$ and $s$ occurences of $s$, which gives $s-1+s \geq \ceil{\frac{k}{2}}+\ceil{\frac{k}{2}}+1 > k$, which is a contradiction.
\end{proof}

Note that Lemma~\ref{lem:twiceInARow} includes runs of longer than two, a fortiriori. 

\begin{theorem}\label{thm:elementUpperBound}
All elements of a $k$-foggy sequence have an upper bound of $\ceil{\frac{k}{2}}+1$.
\end{theorem}

\begin{proof}
Let $S_k = a_k(t-k+1:t)$ be the subsequence of length $k$ preceeding $a_k(t)$. We know that $S_k$ must contain $a_k(t) > \ceil{\frac{k}{2}}+1$ copies of $a_k(t-1)$. Let $a^*=a_k(t-1)$ be the repeated element. From Lemma~\ref{lem:twiceInARow}, we know that $a^*\leq \ceil{\frac{k}{2}}$, as otherwise it could appear only at every other position in $S_k$, which only $\ceil{frac{k}{2}}$ occurences. From Lemma~\ref{lem:longestRun}, we know that there cannot be more than $a^*+1$ occurences of $a^*$ in a row within $S_k$. After the initial set of $a^*+1$ occurences in $S_k$, all occurences of $a^*$ must be singletons, as the subsequent element is the count of occurences of $a^*$ which will be greater than $a^*+1$. Therefore, if $a_k(t)> \ceil{\frac{k}{2}}+2$, then there must be an $a^*$ in $S_k$ followed by $\ceil{\frac{k}{2}}+2$. It suffices then to prove that it is impossible to construct a sequence yeilding $a_k(t) = \ceil{\frac{k}{2}}+2$.

We begin by assuming the maximal value $a^* = \frac{k}{2}$. We first partition the subseqeunce $S_k$ as shown in~\eqref{eq:partitions1},
\begin{align}
S_k = [\overbrace{s_1,s_2,...,s_{l_1}}^{\mathcal{C}_{a^*}(S_k(1:l_1)) = a^*+1},X^{\neq a^*},a^*].\label{eq:partitions1}
\end{align}
In~\eqref{eq:partitions1}, we have partitioned the first $a^*+1$ occurences of s into the first $l_1$ elements, followed by an element not equal to $a^*$, followed by an $a^*$. In order for the $X^{\neq a^*}$ to be followed by an $a^*$, there must be $a^*$ occurences in the previous $k$ elements, along with the $a^*+1$ occurences of $a^*$ itself in the first $l_1$ elements. Therefore, we have that
\begin{align}
a^* + (a^*+1) &\leq k \\
a^* &\leq \frac{k}{2}-\frac{1}{2} 
\end{align}
which contradicts the assumption $a^*=\frac{k}{2}$. 

We generalize now by assuming s has value $a^* = \frac{k}{2}-i$. We then partition the subseqeunce $S_k$ as shown in~\eqref{eq:partitions2},
\begin{align}
S_k = [\overbrace{s_1,s_2,...,s_{l_1}}^{\mathcal{C}_{a^*}(S_k(1:l_1)) = a^*+1},(X^{\neq a^*},a^*)^{i},X^{\neq a^*},a^*].\label{eq:partitions2}
\end{align}
In order for the final $X^{\neq a^*}$ to be followed by an $a^*$, there must be $a^*$ occurences of it in the previous $k$ elements. Note that after every occurence of $a^*$, after the initial $l_1$ partition, the $X^{\neq a^*}$ is the running total of occurences of $a^*$ in $S_k$. Therefore, the terms $X^{\neq a^*}$ are unique, and summing the number of elements required to generate the final occurence of $a^*$ gives
\begin{align}
a^*+1+2i+a^* &\leq k\\
a^* \leq \frac{k}{2} - i - \frac{1}{2}
\end{align}
which contradicts the assumption that $a^* = \frac{k}{2}-i$.\\

This proof holds if the terms $X^{\neq a^*}$ are substituted for partitions of length $l_i$, containing any number of elements not equal to $a^*$. The scenario in~\eqref{eq:partitions2} is the lower bound of the sizes of the intervening $X^{\neq a^*}$ partitions, and thus holds, as there still must be at least one unique element following every occurence of an $a^*$ (after the initial partition). 
\end{proof}


\section{Acknowledgments}
The authors would like to thank Reddit, for wasting their time and occasionally nerd-sniping them from the rafters. The authors also thank the anonymous referee for careful reading of the paper and suggestions which improved the paper.

\begin{thebibliography}{99}

% \bibitem{Florez}
% R. Fl\'orez and L. Junes,
% A relation between triangular numbers and prime numbers,
% {\it Integers} {\bf 12} (2012), 83--96.

% \bibitem{Gardner1}
% M. Gardner,
% Patterns in primes are a clue to the strong law of small numbers,
% {\it Sci. Amer.} {\bf 243} (6) (1980), 18--28.

% \bibitem{Gardner2}
% M. Gardner,
% {\it The Last Recreations},
% Copernicus, 1997.

% \bibitem{Golomb}
% S. W. Golomb,
% The evidence for Fortune's conjecture.
% {\it Math. Mag.} {\bf 54} (1981), 209--210.

% \bibitem{Guy5}
% R. K. Guy,
% The strong law of small numbers, 
% {\it Amer. Math. Monthly} {\bf 95} (1988), 697--712.

% \bibitem{Guy6}
% R. K. Guy,
% The second strong law of small numbers,
% {\it Math. Mag.} {\bf 63} (1990), 3--20.

% \bibitem{Guy}
% R. K. Guy, 
% {\it Unsolved Problems in Number Theory}, 3rd edition,
% Springer-Verlag, 2004.

% \bibitem{B60} 
% M. K\v r\'{\i}\v zek and L. Somer,
% Euclidean primes have the minimum number of primitive roots,
% {\it JP J. Algebra Number Theory Appl.} {\bf 12} (2008), 121--127.

% \bibitem{A29} 
% M. K\v r\'{\i}\v{z}ek, L. Somer, and A. \v Solcov\'a,
% {\it From Great Discoveries in Number Theory to Applications},
% Springer, 2021.

% \bibitem{Rek}
% K. Rektorys,
% {\it Survey of Applicable Mathematics}, Vol.~1, Kluwer Acad. Publ. Group, 1994.

\bibitem{www}  N. J. A. Sloane et al.,
{\it The On-Line Encyclopedia of Integer Sequences}, 
available at \url{https://oeis.org}, 2022.

\end{thebibliography}



\bigskip
\hrule
\bigskip

\noindent 2010 {\it Mathematics Subject Classification}:
Primary 11A41; Secondary 11N05.

\noindent \emph{Keywords: } 


\bigskip
\hrule
\bigskip

\noindent (Concerned with sequences
\seqnum{A334539}, and
\seqnum{A098168}.)

\noindent
Return to
\htmladdnormallink{Journal of Integer Sequences home page}{https://cs.uwaterloo.ca/journals/JIS/}.
\vskip .1in


\end{document}
